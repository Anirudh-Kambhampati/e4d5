{"ast":null,"code":"var _jsxFileName = \"/Users/akwg7/Documents/react/RISE1/file-explorer-rise/frontend/src/components/FolderTree/FolderTree.jsx\",\n  _s = $RefreshSig$();\nimport _ from \"lodash\";\nimport deepdash from \"deepdash\";\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport Tree from \"react-ui-tree\";\nimport TreeNode from \"./TreeNode\";\nimport \"react-ui-tree/dist/react-ui-tree.css\";\nimport { useLazyUpdateFolderTreeQuery } from \"../../apiServices/treeService\";\nimport { useDispatch } from \"react-redux\";\nimport { setFolderTree } from \"../../redux/folderTree/folderTreeSlice\";\nimport RightContent from \"../../pages/HomePage/RightContent\";\nimport { treeData } from \"../../data/data\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndeepdash(_);\nvar globalVal;\nconst deleteFromTree = (newTree, id) => {\n  let index = -1;\n  const getNode = (a, i) => {\n    if (a.id === id) {\n      index = i;\n      return true;\n    }\n    if (Array.isArray(a.children) && a.children.some(getNode)) {\n      if (~index) {\n        a.children.splice(index, 1);\n        index = -1;\n      }\n      return true;\n    }\n  };\n  [newTree].some(getNode);\n};\nconst FolderTree = _ref => {\n  _s();\n  let {\n    treeData,\n    handleClick,\n    isAdmin,\n    errorMsg = \"Please Provide treeData!\",\n    disableRightClick = false,\n    disableFileAndFolderAddition = false\n  } = _ref;\n  const dispatch = useDispatch();\n  const [tree, setTree] = useState(treeData || {});\n  let {\n    editableFileIds = []\n  } = treeData || {};\n  editableFileIds = useMemo(() => {\n    var _editableFileIds;\n    return Object.assign({}, ...((_editableFileIds = editableFileIds) === null || _editableFileIds === void 0 ? void 0 : _editableFileIds.map(id => ({\n      [id]: true\n    }))));\n  }, [editableFileIds]);\n  globalVal = treeData;\n  console.log(globalVal);\n  const [updateFolderTree] = useLazyUpdateFolderTreeQuery();\n  useEffect(() => {\n    if (treeData && Object.keys(treeData).length) {\n      setTree(prev => ({\n        ...prev,\n        ...treeData\n      }));\n    }\n  }, [treeData]);\n  useEffect(() => {\n    if (tree && Object.keys(tree).length) {\n      dispatch(setFolderTree(_.cloneDeep(tree)));\n    }\n  }, [dispatch, tree]);\n\n  /*===============EVENT HANDLERS STARTS========================== */\n  const handleRename = id => {\n    const renameObj = _.findDeep(tree, item => item.id === id, {\n      childrenPath: \"children\"\n    });\n    const response = prompt(\"Please rename\", renameObj.value.module);\n    // ignore empty string\n    if (!response) {\n      return;\n    }\n    renameObj.value.module = response;\n    const newTree = _.mapDeep(tree, item => item.id === id ? {\n      ...item,\n      ...renameObj.value\n    } : item, {\n      childrenPath: \"children\"\n    });\n    updateTree(newTree[0]);\n  };\n  const handleDelete = id => {\n    deleteFromTree(tree, id);\n    updateTree(tree);\n  };\n  const addItemToTree = (itemType, active) => {\n    const newItem = itemType === \"folder\" ? {\n      id: `root-${Date.now()}`,\n      module: `New ${itemType}`,\n      children: [],\n      collapsed: false\n    } : {\n      id: `${Date.now()}`,\n      leaf: true,\n      module: `New ${itemType}`\n    };\n    const newTree = _.mapDeep(tree, item => {\n      const cloneItem = Object.assign({}, item);\n      if (cloneItem) {\n        if (cloneItem.id === active.id && cloneItem.children) {\n          // folder\n          cloneItem.children.push(newItem);\n        }\n      }\n      return cloneItem;\n    });\n    updateTree(newTree[0]);\n  };\n  const updateTree = async newTree => {\n    const prevTree = tree;\n    setTree(oldTree => ({\n      ...oldTree,\n      ...newTree\n    }));\n    try {\n      if (newTree && Object.keys(newTree).length) {\n        await updateFolderTree({\n          id: newTree._id,\n          tree: _.cloneDeep(newTree)\n        });\n      }\n    } catch (error) {\n      alert(\"Something Unexpected Happened\");\n      setTree(oldTree => ({\n        ...oldTree,\n        ...prevTree\n      }));\n    }\n  };\n  const [data, setData] = useState(\"\");\n\n  /*===============EVENT HANDLERS ENDS========================== */\n\n  const treeNodeProps = {\n    addItemToTree,\n    handleDelete,\n    handleRename,\n    handleClick,\n    disableRightClick,\n    disableFileAndFolderAddition,\n    editableFileIds,\n    isAdmin\n  };\n  if (!treeData || !Object.keys(treeData).length) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: errorMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Tree, {\n      paddingLeft: 20,\n      tree: tree,\n      onChange: updateTree,\n      renderNode: props => /*#__PURE__*/_jsxDEV(TreeNode, {\n        ...props,\n        ...treeNodeProps\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 32\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 162,\n    columnNumber: 5\n  }, this);\n};\n_s(FolderTree, \"4/PbYAaqKwCOFrICzPVM9i0GIxE=\", false, function () {\n  return [useDispatch, useLazyUpdateFolderTreeQuery];\n});\n_c = FolderTree;\nconsole.log(data);\nexport { FolderTree };\nvar _c;\n$RefreshReg$(_c, \"FolderTree\");","map":{"version":3,"names":["_","deepdash","React","useEffect","useState","useMemo","Tree","TreeNode","useLazyUpdateFolderTreeQuery","useDispatch","setFolderTree","RightContent","treeData","globalVal","deleteFromTree","newTree","id","index","getNode","a","i","Array","isArray","children","some","splice","FolderTree","handleClick","isAdmin","errorMsg","disableRightClick","disableFileAndFolderAddition","dispatch","tree","setTree","editableFileIds","Object","assign","map","console","log","updateFolderTree","keys","length","prev","cloneDeep","handleRename","renameObj","findDeep","item","childrenPath","response","prompt","value","module","mapDeep","updateTree","handleDelete","addItemToTree","itemType","active","newItem","Date","now","collapsed","leaf","cloneItem","push","prevTree","oldTree","_id","error","alert","data","setData","treeNodeProps","props"],"sources":["/Users/akwg7/Documents/react/RISE1/file-explorer-rise/frontend/src/components/FolderTree/FolderTree.jsx"],"sourcesContent":["import _ from \"lodash\";\nimport deepdash from \"deepdash\";\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport Tree from \"react-ui-tree\";\n\nimport TreeNode from \"./TreeNode\";\n\nimport \"react-ui-tree/dist/react-ui-tree.css\";\nimport { useLazyUpdateFolderTreeQuery } from \"../../apiServices/treeService\";\nimport { useDispatch } from \"react-redux\";\nimport { setFolderTree } from \"../../redux/folderTree/folderTreeSlice\";\nimport RightContent from \"../../pages/HomePage/RightContent\";\nimport { treeData } from \"../../data/data\";\ndeepdash(_);\n\nvar globalVal;\n\nconst deleteFromTree = (newTree, id) => {\n  let index = -1;\n  const getNode = (a, i) => {\n    if (a.id === id) {\n      index = i;\n      return true;\n    }\n    if (Array.isArray(a.children) && a.children.some(getNode)) {\n      if (~index) {\n        a.children.splice(index, 1);\n        index = -1;\n      }\n      return true;\n    }\n  };\n  [newTree].some(getNode);\n};\n\nconst FolderTree = ({\n  treeData,\n  handleClick,\n  isAdmin,\n  errorMsg = \"Please Provide treeData!\",\n  disableRightClick = false,\n  disableFileAndFolderAddition = false,\n}) => {\n  const dispatch = useDispatch();\n  const [tree, setTree] = useState(treeData || {});\n\n  let { editableFileIds = [] } = treeData || {};\n  editableFileIds = useMemo(\n    () => Object.assign({}, ...editableFileIds?.map((id) => ({ [id]: true }))),\n    [editableFileIds]\n  );\n\n  globalVal = treeData;\n  console.log(globalVal);\n\n  const [updateFolderTree] = useLazyUpdateFolderTreeQuery();\n\n  useEffect(() => {\n    if (treeData && Object.keys(treeData).length) {\n      setTree((prev) => ({ ...prev, ...treeData }));\n    }\n  }, [treeData]);\n\n  useEffect(() => {\n    if (tree && Object.keys(tree).length) {\n      dispatch(setFolderTree(_.cloneDeep(tree)));\n    }\n  }, [dispatch, tree]);\n\n  /*===============EVENT HANDLERS STARTS========================== */\n  const handleRename = (id) => {\n    const renameObj = _.findDeep(tree, (item) => item.id === id, {\n      childrenPath: \"children\",\n    });\n    const response = prompt(\"Please rename\", renameObj.value.module);\n    // ignore empty string\n    if (!response) {\n      return;\n    }\n    renameObj.value.module = response;\n\n    const newTree = _.mapDeep(\n      tree,\n      (item) =>\n        item.id === id\n          ? {\n              ...item,\n              ...renameObj.value,\n            }\n          : item,\n      { childrenPath: \"children\" }\n    );\n    updateTree(newTree[0]);\n  };\n\n  const handleDelete = (id) => {\n    deleteFromTree(tree, id);\n    updateTree(tree);\n  };\n\n  const addItemToTree = (itemType, active) => {\n    const newItem =\n      itemType === \"folder\"\n        ? {\n            id: `root-${Date.now()}`,\n            module: `New ${itemType}`,\n            children: [],\n            collapsed: false,\n          }\n        : { id: `${Date.now()}`, leaf: true, module: `New ${itemType}` };\n\n    const newTree = _.mapDeep(tree, (item) => {\n      const cloneItem = Object.assign({}, item);\n      if (cloneItem) {\n        if (cloneItem.id === active.id && cloneItem.children) {\n          // folder\n          cloneItem.children.push(newItem);\n        }\n      }\n      return cloneItem;\n    });\n    updateTree(newTree[0]);\n  };\n\n  const updateTree = async (newTree) => {\n    const prevTree = tree;\n    setTree((oldTree) => ({ ...oldTree, ...newTree }));\n\n    try {\n      if (newTree && Object.keys(newTree).length) {\n        await updateFolderTree({\n          id: newTree._id,\n          tree: _.cloneDeep(newTree),\n        });\n      }\n    } catch (error) {\n      alert(\"Something Unexpected Happened\");\n      setTree((oldTree) => ({ ...oldTree, ...prevTree }));\n    }\n  };\n\n  const [data, setData] = useState(\"\");\n\n  /*===============EVENT HANDLERS ENDS========================== */\n\n  const treeNodeProps = {\n    addItemToTree,\n    handleDelete,\n    handleRename,\n    handleClick,\n    disableRightClick,\n    disableFileAndFolderAddition,\n    editableFileIds,\n    isAdmin,\n  };\n\n  if (!treeData || !Object.keys(treeData).length) {\n    return <div>{errorMsg}</div>;\n  }\n\n  return (\n    <div>\n      <Tree\n        paddingLeft={20}\n        tree={tree}\n        onChange={updateTree}\n        renderNode={(props) => <TreeNode {...props} {...treeNodeProps} />}\n      />\n    </div>\n  );\n};\n\nconsole.log(data);\n\nexport { FolderTree };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}